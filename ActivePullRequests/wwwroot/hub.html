<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Hello Visual Studio Team Services!</title>
    <script src="sdk/scripts/VSS.SDK.js"></script>
</head>

<body>
    <div id="hub-title" title="All Repositories" style="font-size: 18px;font-weight: 200; font-family: Segoe UI,Arial,Verdana,Helvetica Neue,Helvetica;">All Repositories</div>
    <div id="grid-container"></div>

    <script type="text/javascript">
        // Sets up the initial handshake with the host frame
        VSS.init({
            // Our extension will explicitly notify the host when we're done loading
            explicitNotifyLoaded: true,

            // We are using some VSO APIs, so we will need the module loader to load them in
            usePlatformScripts: true,
            usePlatformStyles: true
        });
           
        // Load Team Services controls
        VSS.require(["VSS/Controls", "VSS/Controls/Grids",
            "VSS/Service", "TFS/VersionControl/GitRestClient"],
            function (Controls, Grids, VSS_Service, TFS_Git_WebApi) {

                // Get a WIT client to make REST calls to VSTS
                // var workClient = VSS_Service.getCollectionClient(TFS_Work_WebApi.WorkItemTrackingHttpClient);
                var gitClient = TFS_Git_WebApi.getClient();

                // Spit out the project name to console just to see if we can get some info
                var projectName = VSS.getWebContext().project.name;

                // Call the "getRepositories" REST endpoint, giving a query ID
                gitClient.getRepositories(projectName, true).then(function(repos) {
                    console.log("Count: " + repos.length);
                    var newTitleText = $("#hub-title").text() + " (" + repos.length + ")"
                    $("#hub-title").text(newTitleText);
                    
                    // Create a Grid control to display the repos
                    Controls.create(Grids.Grid, $("#grid-container"), {
                        height: "1000px", // Explicit height is required for a Grid control
                        columns: [
                            // text is the column header text. 
                            // index is the key into the source object to find the data for this column
                            // width is the width of the column, in pixels
                            { text: "id", index: "id", width: 150 },
                            { text: "name", index: "name", width: 150 },
                            { text: "url", index: "url", width: 600 }
                        ],
                        // This data source is rendered into the Grid columns defined above
                        source: repos
                    });                 
                });

                VSS.notifyLoadSucceeded();
            });            
    </script>
</body>

</html>